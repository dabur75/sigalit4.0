# תכנון: התחברות עם שם משתמש וסיסמה

## 📋 פרטי המשימה
- **מזהה משימה**: `PLAN-002`
- **כותרת המשימה**: הוספת התחברות עם שם משתמש וסיסמה
- **עדיפות**: HIGH
- **משך זמן משוער**: Medium
- **ספרינט יעד**: השבוע הקרוב

## 🎯 סקירת המשימה

### ערך עסקי
מערכת Sigalit צריכה לתמוך בהתחברות מקומית עם שם משתמש וסיסמה. זה יאפשר:
- שליטה מלאה במשתמשים במערכת
- התחברות מהירה ופשוטה ללא תלות בשירותים חיצוניים
- ניהול סיסמאות מקומי ובטוח
- גישה לכל המשתמשים ללא צורך בחשבונות חיצוניים

### סיפורי משתמש
- כמשתמש, אני רוצה להתחבר עם שם משתמש וסיסמה כדי לגשת למערכת
- כמנהל, אני רוצה ליצור משתמשים עם שם משתמש וסיסמה
- כמשתמש, אני רוצה לאפס את הסיסמה שלי אם שכחתי אותה
- כמנהל, אני רוצה לנהל סיסמאות משתמשים

### קריטריוני הצלחה
- [ ] התחברות עם שם משתמש וסיסמה פועלת
- [ ] הצפנת סיסמאות בטוחה (bcrypt)
- [ ] ממשק עברי ל-RTL
- [ ] אפסות סיסמה (אופציונלי)
- [ ] ניהול משתמשים למנהלים

## 🏗️ עיצוב טכני

### שינויי ארכיטקטורה
הוספת Credentials Provider ל-NextAuth.js עם תמיכה ב:
- הצפנת סיסמאות עם bcrypt
- אימות שם משתמש/סיסמה
- ניהול סשן מקומי בלבד
- הסרת תלות ב-OAuth providers

### שינויי מסד נתונים
- [ ] הוספת שדה `username` למודל User (אופציונלי)
- [ ] הוספת שדה `password` למודל User (מוצפן)
- [ ] הוספת שדה `isLocalUser` למודל User
- [ ] יצירת אינדקסים על username

### שינויי API
- [ ] הוספת Credentials Provider ל-NextAuth
- [ ] הסרת Discord OAuth Provider
- [ ] יצירת נתיב לאפסות סיסמה
- [ ] הוספת validation schemas עם Zod
- [ ] בדיקות אבטחה
- [ ] ניהול משתמשים (יצירה, עריכה, מחיקה)

### שינויי Frontend
- [ ] יצירת טופס התחברות עם שם משתמש/סיסמה
- [ ] הסרת אפשרויות Discord OAuth
- [ ] שיפור עמוד ההתחברות הקיים
- [ ] הוספת ממשק ניהול משתמשים למנהלים
- [ ] הודעות שגיאה בעברית
- [ ] טופס יצירת משתמשים חדשים

## 📁 קבצים שיש לשנות

### קבצים חדשים
- `src/lib/auth-utils.ts` - כלי עזר לאימות וסיסמאות
- `src/app/auth/reset-password/page.tsx` - עמוד איפוס סיסמה
- `src/app/auth/signup/page.tsx` - עמוד יצירת משתמש חדש
- `src/server/api/routers/auth.ts` - נתיבי API לאימות וניהול משתמשים
- `src/app/admin/users/page.tsx` - עמוד ניהול משתמשים למנהלים

### קבצים קיימים לשינוי
- `src/server/auth/config.ts` - החלפת Discord OAuth ב-Credentials Provider
- `src/app/auth/signin/page.tsx` - יצירת טופס התחברות חדש
- `prisma/schema.prisma` - הוספת שדות username ו-password
- `src/env.js` - הסרת משתני Discord OAuth
- `.env` - הסרת משתני Discord OAuth

### מסד נתונים
- `prisma/schema.prisma` - שינויים בסכמה
- `prisma/migrations/` - מיגרציות חדשות
- `prisma/seed.ts` - הוספת משתמשים עם סיסמאות

## 🔧 תכנית יישום

### שלב 1: עדכון מסד נתונים
1. [ ] הוספת שדות username ו-password למודל User
2. [ ] יצירת מיגרציה
3. [ ] עדכון seed script עם משתמשים לדוגמה

### שלב 2: אימות וסיסמאות
1. [ ] התקנת bcrypt
2. [ ] יצירת כלי עזר לסיסמאות
3. [ ] החלפת Discord OAuth ב-Credentials Provider
4. [ ] בדיקות אבטחה

### שלב 3: ממשק משתמש
1. [ ] יצירת עמוד התחברות חדש עם טופס שם משתמש/סיסמה
2. [ ] הוספת עמוד יצירת משתמש חדש
3. [ ] הוספת עמוד ניהול משתמשים למנהלים
4. [ ] הודעות שגיאה בעברית
5. [ ] עיצוב RTL מלא

## 🧪 אסטרטגיית בדיקות

### בדיקות יחידה
- [ ] בדיקת הצפנת סיסמאות
- [ ] בדיקת אימות נתונים
- [ ] בדיקת validation schemas

### בדיקות אינטגרציה
- [ ] בדיקת תהליך התחברות מלא עם שם משתמש/סיסמה
- [ ] בדיקת אינטגרציה עם NextAuth (Credentials Provider)
- [ ] בדיקת שמירה במסד נתונים
- [ ] בדיקת יצירת משתמשים חדשים
- [ ] בדיקת ניהול משתמשים למנהלים

### בדיקות ידניות
- [ ] תמיכה בעברית RTL
- [ ] עיצוב רספונסיבי
- [ ] תאימות דפדפנים

## 📊 הערכת סיכונים

### סיכונים טכניים
- תאימות NextAuth עם Credentials - **פתרון**: שימוש בתיעוד הרשמי
- אבטחת סיסמאות - **פתרון**: שימוש ב-bcrypt ובאמצעי הגנה מתקדמים
- הסרת Discord OAuth - **פתרון**: בדיקה יסודית שלא נשארו תלויות
- מעבר מסד נתונים - **פתרון**: מיגרציה בטוחה עם גיבוי

### סיכוני לוח זמנים
- מורכבות אינטגרציה - **פתרון**: פיתוח בשלבים קטנים
- בדיקות אבטחה - **פתרון**: שימוש בכלים אוטומטיים

### סיכוני איכות
- בעיות אבטחה - **פתרון**: code review וbest practices

## 📚 דרישות תיעוד

### תיעוד משתמש
- [ ] מדריך התחברות עם שם משתמש וסיסמה
- [ ] מדריך איפוס סיסמה
- [ ] צילומי מסך בעברית

### תיעוד טכני
- [ ] תיעוד API החדש
- [ ] תיעוד רכיבי UI
- [ ] עדכון תיעוד מסד נתונים

### תיעוד פרויקט
- [ ] עדכון PROJECT.md
- [ ] עדכון README
- [ ] תרשימי ארכיטקטורה

## 🎯 מדדי הצלחה

### דרישות פונקציונליות
- [ ] כל סיפורי המשתמש מיושמים
- [ ] קריטריוני ההצלחה מתקיימים
- [ ] אין באגים קריטיים

### דרישות איכות
- [ ] התאמה ל-TypeScript strict mode
- [ ] עמידה בחוקי ESLint
- [ ] תמיכה בעברית RTL נשמרת
- [ ] עיצוב רספונסיבי פועל

### דרישות ביצועים
- [ ] זמני טעינה סבירים
- [ ] שאילתות מסד נתונים מותאמות
- [ ] גודל bundle בגבולות

## 💰 דרישות משאבים

### זמן פיתוח
- **Frontend**: 6 שעות (עמודים חדשים + ניהול משתמשים)
- **Backend**: 8 שעות (Credentials Provider + ניהול משתמשים)
- **מסד נתונים**: 3 שעות (מיגרציה + הסרת OAuth)
- **בדיקות**: 4 שעות (בדיקות מקיפות יותר)
- **תיעוד**: 2 שעות (עדכונים רבים)
- **סה"כ**: 23 שעות

### תלויות
- [ ] חבילת bcrypt
- [ ] הסרת Discord OAuth dependencies
- [ ] עדכון משתני סביבה
- [ ] גיבוי מסד נתונים לפני מיגרציה

## 📅 לוח זמנים

### שבוע 1
- [ ] עדכון מסד נתונים וסכמה
- [ ] הסרת Discord OAuth dependencies
- [ ] הוספת כלי עזר לסיסמאות

### שבוע 2
- [ ] החלפת OAuth ב-Credentials Provider
- [ ] יצירת ממשקי משתמש חדשים
- [ ] בדיקות ואופטימיזציה

### שבוע 3
- [ ] הוספת ניהול משתמשים למנהלים
- [ ] בדיקות סופיות ותיעוד

## 🔍 סקירה ואישור

### סקירה עצמית של המפתח
- [ ] התכנית מלאה וברורה
- [ ] הגישה הטכנית נכונה
- [ ] לוח הזמנים ריאלי
- [ ] סיכונים מזוהים ומתומנים

### סקירת בעלי עניין
- [ ] הערך העסקי ברור
- [ ] סיפורי המשתמש מוגדרים היטב
- [ ] קריטריוני ההצלחה ניתנים למדידה
- [ ] לוח הזמנים מקובל

### סקירה טכנית
- [ ] הארכיטקטורה מתאימה
- [ ] תכנית היישום ניתנת לביצוע
- [ ] אסטרטגיית הבדיקות מקיפה
- [ ] דרישות התיעוד ברורות

---

**סטטוס**: [ ] טיוטה | [x] מוכן לסקירה | [ ] אושר | [ ] נדחה
**מפתח**: AI Assistant
**סוקר**: דביר
**תאריך אישור**: [יש למלא]
**הערות**: אנא סקור ואשר לפני תחילת הפיתוח
